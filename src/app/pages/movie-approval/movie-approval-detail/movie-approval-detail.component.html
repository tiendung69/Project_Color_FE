
<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; margin-top: -30px;">
  <div style="display: flex; align-items: center; margin-top: 40px; width: 50%; margin-bottom: -30px">
    <div style="border-bottom: 1px solid #000; flex-grow: 1; width: 25%;"></div>
    <div style="flex-grow: 1; text-align: center;">
      <div style="padding: 0 10px; font-size: 25px; font-family: 'Museo Sans Rounded'; font-weight: 900;" class="label-title;">THÔNG TIN CHUNG</div>
    </div>
    <div style="border-bottom: 1px solid #000; flex-grow: 1; width: 25%;"></div>
  </div>
</div>


<label class="label-title" style="margin-top: 25px;">Thông tin hội đồng duyệt phim</label>

<div class="d-flex container-collapse" (click)="toggleCollapse()">
  <div class="fa-1x mx-4 my-3">
    <i [className]="isCollapsed ? 'fa fa-plus' : 'fa fa-minus'"></i>
  </div>
  <span class="label-custom">Thông tin duyệt phim</span>
</div>
<form [ngbCollapse]="isCollapsed" (ngSubmit)="onSubmit()" #form="ngForm">
  <div id="collapseExample">
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="form-group col-md-6" style="margin-top: 8px">
            <label class="label-custom">Tên phim*</label>
            <ejs-textbox
              *ngIf="
                listMovieApproval?.PostProductionPlaning?.PreProduction?.Name
              "
              [value]="
                listMovieApproval.PostProductionPlaning.PreProduction.Name
              "
              [readonly]="true"
            >
            </ejs-textbox>
          </div>
          <div class="form-group col-md-6" style="margin-top: 8px">
            <label class="label-custom">Nội dung</label>
            <ejs-textbox
              [value]="listMovieApproval.Content"
              placeholder="Nội dung"
              (valueChange)="
                onInputChangeMain({ key: 'Content', value: $event })
              "
            >
            </ejs-textbox>
          </div>

          <div class="form-group col-md-6" style="margin-top: 8px">
            <label class="label-custom">Thời gian bắt đầu duyệt</label>
            <ejs-datepicker
              [value]="listMovieApproval.StartAt"
              placeholder="Thời gian bắt đầu"
              format="dd/MM/yyyy"
              type="date"
              (valueChange)="
                onInputChangeMain({ key: 'StartAt', value: $event })
              "
            >
            </ejs-datepicker>
          </div>

          <div class="form-group col-md-6" style="margin-top: 8px">
            <label class="label-custom">Thời gian kết thúc duyệt</label>
            <ejs-datepicker
              type="date"
              [value]="listMovieApproval.EndAt"
              placeholder="Thời gian kết thúc"
              format="dd/MM/yyyy"
              (valueChange)="onInputChangeMain({ key: 'EndAt', value: $event })"
            >
            </ejs-datepicker>
          </div>
          <div
            class="form-group col-md-6"
            style="margin-top: 8px"
            *ngIf="nameVideo != undefined"
          >
            <label class="label-custom">Xem phim: </label>
            <a href="{{ nameVideo.VideoUrl }}" target="_blank">
              <i
                class="fa fa-download"
                style="margin-left: 10px"
                aria-hidden="true"
              >
                Nhấn để tải xuống</i
              >
            </a>
          </div>
        </div>
        <div class="row col justify-content-center mt-5" *ngIf="checkApproved">
          <button
            class="btn btn-secondary btn-custom mr-4 btn-custom-large py-2"
            type="button"
            (click)="onCancelClick()"
          >
            Hủy
          </button>
          <button
            class="btn btn-primary btn-custom btn-custom-large py-2"
            type="submit"
            content="Save"
          >
            Lưu
          </button>
        </div>
      </div>
    </div>
  </div>
</form>

<div class="hr"></div>
<!-- Show spinner overlay -->
<!-- <div *ngIf="isCreating" class="spinner-overlay">
  <div class="spinner-overlay-content"></div>
</div> -->
<div [ngbCollapse]="idMovieApproval ? false : true">
  <div class="d-flex container-collapse" (click)="toggleCollapse1()">
    <div class="fa-1x mx-4 my-3">
      <i [className]="isCollasped1 ? 'fa fa-plus' : 'fa fa-minus'"></i>
    </div>
    <span class="label-custom">Thành viên hội đồng duyệt phim</span>
  </div>
  <ejs-grid
    #gridMember
    [ngbCollapse]="isCollasped1"
    [dataSource]="listMovieDetail"
    [pageSettings]="pageSettings"
    [editSettings]="editSettings"
    [toolbar]="toolbarOptions"
    [allowTextWrap]="true"
    [allowPaging]="true"
    (actionComplete)="actionCompleteListMember($event)"
    (actionBegin)="actionBeginListMember($event)"
  >
    <e-columns>
      <e-column field="UserId" headerText="Thành viên">
        <ng-template let-data #template>{{
          handleRenderMember(data.UserId)
        }}</ng-template>
        <ng-template #editTemplate let-data>
          <ejs-dropdownlist
            *ngIf="listUser"
            [ngModelOptions]="{ standalone: true }"
            [dataSource]="listUser"
            placeholder="Thành viên"
            [(ngModel)]="data.UserId"
            [fields]="dropdownUser"
            floatLabelType="Auto"
            [itemTemplate]="itemTemplate"
            [valueTemplate]="valueTemplate"
            (valueChange)="onInputChange({ key: 'UserId', value: $event })"
          >
            <ng-template #itemTemplate let-data>
              <span>{{ data.FirstName }} {{ data.LastName }}</span>
            </ng-template>

            <ng-template #valueTemplate let-data>
              <span>{{ data.FirstName }} {{ data.LastName }}</span>
            </ng-template>
          </ejs-dropdownlist>
          <p *ngIf="messageUser" style="color: red">
            Thông tin này là bắt buộc
          </p>
        </ng-template>
      </e-column>
      <e-column field="Role" headerText="Vai trò">
        <ng-template let-data #editTemplate>
          <div class="multiline">
            <ejs-textbox
              [value]="data.Role"
              (valueChange)="onInputChange({ key: 'Role', value: $event })"
              placeHolder="Vai trò"
              floatLabelType="Auto"
            >
            </ejs-textbox>
          </div>
        </ng-template>
      </e-column>
      <!-- <e-column field="FromDate" headerText="Thời gian bắt đầu duyệt">
        <ng-template let-data #editTemplate>
          <ejs-datepicker
            [value]="data.FromDate"
            floatLabelType="Auto"
            placeholder="Thời gian bắt đầu"
            (valueChange)="onInputChange({ key: 'FromDate', value: $event })"
          >
          </ejs-datepicker>
        </ng-template>
      </e-column>
      <e-column field="FromDate" headerText="Thời gian kết thúc duyệt ">
        <ng-template let-data #editTemplate>
          <ejs-datepicker
            [value]="data.ToDate"
            floatLabelType="Auto"
            placeholder="Thời gian kết thúc"
            (valueChange)="onInputChange({ key: 'FromDate', value: $event })"
          >
          </ejs-datepicker>
        </ng-template>
      </e-column> -->
      <e-column field="Suggested" headerText="Chú thích">
        <ng-template let-data #editTemplate>
          <div class="multiline">
            <ejs-textbox
              [value]="data.Suggested"
              placeHolder="Chú thích"
              floatLabelType="Auto"
              (valueChange)="onInputChange({ key: 'Suggested', value: $event })"
            >
            </ejs-textbox>
          </div>
        </ng-template>
      </e-column>
      <e-column field="Comment" headerText="Nhận xét">
        <ng-template let-data #editTemplate>
          <!-- <div class="multiline">
            <ejs-textbox
              [value]="data.Comment"
              placeHolder="Nhận xét"
              floatLabelType="Always"
              [readonly]="true"
              (valueChange)="onInputChange({ key: 'Comment', value: $event })"
            >
            </ejs-textbox>
          </div> -->
        </ng-template>
      </e-column>
      <e-column
        field="Status"
        headerText="Trạng thái "
        [template]="templateStatus"
        [editTemplate]="editTemplate"
      >
        <ng-template #templateStatus let-data>
          {{ rederStatus(data) }}
        </ng-template>
        <ng-template #editTemplate let-data>
          <!-- <ejs-dropdownlist
            [dataSource]="listStatus"
            [fields]="fieldDropdown"
            [value]="data.Status"
            [readonly]="true"
            placeholder="Trạng thái"
            floatLabelType="Auto"
          >
          </ejs-dropdownlist> -->
        </ng-template>
      </e-column>
    </e-columns>
  </ejs-grid>
</div>

<div *ngIf="idMovieApproval" style="display: flex; flex-direction: column; align-items: center; justify-content: center; margin-top: -30px;">
  <div *ngIf="listMovieApproval.Status !== 0 || enableApprove" style="display: flex; align-items: center; margin-top: 65px; width: 50%; margin-bottom: -30px">
    <div style="border-bottom: 1px solid #000; flex-grow: 1; width: 25%;"></div>
    <div style="flex-grow: 1; text-align: center;">
      <div style="padding: 0 10px; font-size: 25px; font-family: 'Museo Sans Rounded'; font-weight: 900;" class="label-title;">LÃNH ĐẠO DUYỆT</div>
    </div>
    <div style="border-bottom: 1px solid #000; flex-grow: 1; width: 25%;"></div>
  </div>
</div>



<div *ngIf="listMovieApproval.Status !== 0 || enableApprove">
  <label
    *ngIf="idMovieApproval"
    class="label-title"
    style="width: 100%; margin-top: 25px; margin-bottom: 16px"
    >Phê duyệt phim</label
  >
  <div [ngbCollapse]="idMovieApproval ? false : true">
    <div class="d-flex container-collapse" (click)="toggleCollapse3()">
      <div class="fa-1x mx-4 my-3">
        <i [className]="isCollapsed3 ? 'fa fa-plus' : 'fa fa-minus'"></i>
      </div>
      <span class="label-custom">Thông tin phê duyệt</span>
    </div>

    <div [ngbCollapse]="isCollapsed3" id="collapseExample">
      <div class="card">
        <div class="card-body">
          <form>
            <div class="row" *ngIf="aprovedTimes > 0">
              <!-- <div class="form-group col-3">
                <label class="label-custom" for="Name">Người duyệt: </label>
                <span>
                  {{ handleRenderMember(approvedDetail.ProcessedBy) }}</span
                >
              </div> -->
              <div class="form-group col-4">
                <label class="label-custom" for="Name">Ngày duyệt: </label>
                <span *ngIf="approvedDetail.ProcessedAt">
                  {{ handleRenderDate(approvedDetail.ProcessedAt) }}</span
                >
              </div>
              <div class="form-group col-4">
                <label class="label-custom" for="Name">Kết quả duyệt: </label>
                <span> {{ handleRenderResult(approvedDetail.Result) }}</span>
              </div>
              <div class="form-group col-4">
                <label class="label-custom" for="Name">Lần duyệt: </label>
                <span> {{ aprovedTimes }}</span>
              </div>
            </div>
            <div class="row">
              <div class="form-group col">
                <label class="label-custom" for="Name">Nhận xét</label>
                <app-textarea-input
                  [multiline]="true"
                  [readonly]="!enableApprove"
                  (newItemEvent)="onInputComment($event)"
                  key="Comment"
                  [value]="
                    approvedDetail !== undefined ? approvedDetail.Comment : ''
                  "
                  placeHolder="Nhập nhận xét..."
                ></app-textarea-input>
              </div>
            </div>
            <div
              class="row justify-content-center mt-4 mb-5"
              *ngIf="enableApprove"
            >
              <button
                *ngIf="listMovieApproval.Status != 3"
                class="btn btn-secondary btn-custom mr-4 btn-custom-large py-2"
                type="button"
                (click)="onSubmitApprove(status.REJECT)"
              >
                Từ chối
              </button>
              <button
                class="btn btn-primary btn-custom btn-custom-large py-2"
                type="submit"
                content="Save"
                (click)="onSubmitApprove(status.APPROVE)"
              >
                Phê duyệt
              </button>
            </div>
          </form>
        </div>
      </div>
      <div #container class="root-container"></div>
    </div>
  </div>
</div>

<!-- <div *ngIf="listApproved && listApproved.length">
  <div *ngFor="let item of listApproved">
    <div>{{ item.ObjectId }}</div>
  </div>
</div> -->

<div [ngbCollapse]="idMovieApproval ? false : true" style="margin-top: 10px">
  <div class="d-flex container-collapse" (click)="toggleCollapse5()">
    <div class="fa-1x mx-4 my-3">
      <i [className]="isCollapsed5 ? 'fa fa-plus' : 'fa fa-minus'"></i>
    </div>
    <span class="label-custom">Lịch sử phê duyệt</span>
  </div>
  <div *ngIf="listApproved.length === 0" class="no-approval-history">
    <div [ngbCollapse]="isCollapsed5">
      <div
        class="card"
        style="margin-top: 10px; border: 0px"
        style="height: 57px"
      >
        <div class="card-body">
          <p style="color: red">Chưa có lượt duyệt nào.</p>
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="listApproved && listApproved.length">
    <div *ngFor="let item of listApproved; let i = index">
      <div [ngbCollapse]="isCollapsed5">
        <div class="card" style="margin-top: -5px">
          <div class="card-body">
            <form>
              <div class="row" *ngIf="aprovedTimes - i > 0">
                <div class="form-group col-4">
                  <label class="label-custom" for="Name"
                    >Ngày duyệt:&nbsp;</label
                  >
                  <span *ngIf="item.ProcessedAt">{{
                    handleRenderDate(item.ProcessedAt)
                  }}</span>
                </div>
                <div class="form-group col-4">
                  <label class="label-custom" for="Name"
                    >Kết quả duyệt:&nbsp;</label
                  >
                  <span>{{ handleRenderResult(item.Result) }}</span>
                </div>
                <div class="form-group col-4">
                  <label class="label-custom" for="Name"
                    >Lần duyệt:&nbsp;</label
                  >
                  <span>{{ aprovedTimes - i }}</span>
                </div>
              </div>
              <div class="row">
                <div class="form-group col">
                  <label
                    class="label-custom"
                    for="Name"
                    (click)="toggleCommentVisibility(i)"
                  >
                    <div style="display: flex; align-items: center">
                      <div
                        style="
                          margin-right: 10px;
                          font-size: 23px;
                          margin-top: -6px;
                        "
                      >
                        {{
                          i === selectedCommentIndex && isCommentVisible
                            ? "-"
                            : "+"
                        }}
                      </div>
                      Nhận xét
                    </div>
                  </label>
                </div>
              </div>

              <div
                class="row"
                *ngIf="isCommentVisible && i === selectedCommentIndex"
              >
                <div class="form-group col">
                  <app-textarea-input
                    [multiline]="true"
                    [readonly]="true"
                    (newItemEvent)="onInputComment($event)"
                    key="Comment"
                    [value]="item !== undefined ? item.Comment : ''"
                  ></app-textarea-input>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div #container class="root-container"></div>
      </div>
    </div>
  </div>
</div>
<div #container class="root-container"></div>
<ejs-dialog #ejDialogMember [visible]="false" [target]="targetElement" width="300px">
</ejs-dialog>